# 추론 엔진 vs 공리 및 제약조건: 차이점 설명

## 개요

이 문서는 Ontology Explorer에서 구현된 세 가지 시스템의 차이점을 설명합니다:
1. **추론 엔진 (Reasoning Engine)** - 추론 규칙
2. **공리 (Axioms)** - 논리적 일관성 검증
3. **제약조건 (Constraints)** - 데이터 품질 검증

---

## 핵심 차이점 요약

| 구분 | 추론 엔진 | 공리 | 제약조건 |
|------|----------|------|----------|
| **목적** | 새로운 지식 **생성** | 논리적 일관성 **검증** | 데이터 품질 **검증** |
| **동작** | 새 노드/관계 생성 | 구조적 규칙 확인 | 값 범위/개수 확인 |
| **데이터 변경** | O (그래프 수정) | X (읽기 전용) | X (읽기 전용) |
| **결과물** | 추론된 데이터 | 위반 목록 | 위반 목록 |
| **롤백 가능** | O (삭제 가능) | 해당 없음 | 해당 없음 |

---

## 1. 추론 엔진 (Reasoning Engine)

### 위치
- `backend/app/services/reasoning_service.py`
- RULES 리스트 (8개 규칙)

### 목적
**기존 데이터를 분석하여 새로운 지식을 추론(생성)**

### 규칙 예시

| 규칙 ID | 이름 | 설명 |
|---------|------|------|
| rule_maintenance_needed | 유지보수 필요 규칙 | 건강 점수 < 60인 설비에 유지보수 노드 생성 |
| rule_anomaly_from_sensor | 이상 탐지 규칙 | 정상 범위 벗어난 센서값에서 이상 노드 생성 |
| rule_failure_prediction | 고장 예측 규칙 | 트렌드 분석으로 고장 예측 노드 생성 |
| axiom_property_chain | 속성 체인 추론 (공리) | FEEDS_INTO + LOCATED_IN → INFLUENCES 관계 생성 |
| axiom_health_subsumption | 건강 상태 분류 (공리) | healthScore로 상태 분류 노드 생성 |

### 동작 방식
```
기존 데이터 → 조건 확인 → 새로운 노드/관계 생성
```

### 특징
- 생성된 데이터는 `isInferred: true`로 마킹됨
- "추론 결과 삭제" 버튼으로 롤백 가능
- 버튼: **확인** (미리보기), **적용** (실제 생성), **추론 과정** (단계별 추적)

---

## 2. 공리 (Axioms)

### 위치
- `backend/app/services/axiom_service.py`
- AXIOMS 리스트 (11개 공리)

### 목적
**온톨로지의 논리적 일관성/구조적 무결성 검증**

### 공리 예시

| 공리 ID | 이름 | 설명 |
|---------|------|------|
| AX001 | 장비-센서 분리 공리 | Equipment와 Sensor는 서로 다른 클래스 |
| AX002 | healthScore 도메인 제약 | healthScore는 Equipment에만 존재 |
| AX003 | HAS_SENSOR-IS_ATTACHED_TO 역관계 | 두 관계는 반드시 함께 존재해야 함 |
| AX004 | FEEDS_INTO 전이성 | A→B, B→C이면 A→C도 성립 |
| AX005 | healthScore 단일값 제약 | 각 설비는 정확히 하나의 healthScore만 가짐 |

### 동작 방식
```
기존 데이터 → 논리적 규칙 확인 → 위반 여부 반환
```

### 특징
- OWL(Web Ontology Language) 표준 기반
- 도메인에 독립적인 형식적 논리 규칙
- 버튼: **검증** (위반 사항 확인)

---

## 3. 제약조건 (Constraints)

### 위치
- `backend/app/services/constraint_service.py`
- CONSTRAINTS 리스트 (11개 제약조건)

### 목적
**비즈니스 규칙/도메인 특화 데이터 품질 검증**

### 제약조건 예시

| 제약 ID | 이름 | 설명 |
|---------|------|------|
| CONS001 | 필수 속성: 장비 ID | Equipment는 equipmentId, name, type 필수 |
| CONS002 | healthScore 범위 제약 | 0 ~ 100 사이 값 |
| CONS005 | 온도 센서 범위 | -50°C ~ 200°C |
| CONS006 | RO 압력 범위 | 8 ~ 15 bar |
| CONS009 | 출력 전도도 최대값 | 초순수 출력 전도도 ≤ 1.0 μS/cm |

### 동작 방식
```
기존 데이터 → 값 범위/개수 확인 → 위반 여부 반환
```

### 특징
- UPW(초순수) 산업 도메인 특화 규칙
- 실제 운영 환경의 허용 범위 기반
- 버튼: **검증** (위반 사항 확인)

---

## 시각적 비교

### 추론 엔진 화면
```
┌─────────────────────────────────────┐
│  추론 엔진                           │
├─────────────────────────────────────┤
│  8 추론 규칙 │ 44 추론된 노드 │ ...  │
├─────────────────────────────────────┤
│  ┌─────────────────────────────┐    │
│  │ 유지보수 필요 규칙 [유지보수]  │    │
│  │ [확인] [적용] [추론 과정]     │ ← 데이터 생성
│  └─────────────────────────────┘    │
└─────────────────────────────────────┘
```

### 공리 및 제약조건 화면
```
┌─────────────────────────────────────┐
│  공리 및 제약조건                     │
├─────────────────────────────────────┤
│  11 공리 │ 11 제약조건 │ 0 위반 │ ... │
├─────────────────────────────────────┤
│  ┌─────────────────────────────┐    │
│  │ 장비-센서 분리 공리 [분리 클래스] │    │
│  │ [검증]                       │ ← 데이터 검증만
│  └─────────────────────────────┘    │
└─────────────────────────────────────┘
```

---

## 왜 "공리" 카테고리가 추론 엔진에도 있나요?

추론 엔진의 일부 규칙(예: "속성 체인 추론", "건강 상태 분류", "역속성 전파")은 이름에 "(공리)"가 포함되어 있습니다. 이는:

1. **이론적 배경**: 이 규칙들이 OWL 공리 개념(Property Chain, Subsumption, Inverse Property)에서 유래했기 때문
2. **실제 동작**: 하지만 이들은 **검증이 아닌 추론(생성)**을 수행
3. **구분**:
   - 공리 탭의 공리 = 검증만 수행
   - 추론 엔진의 공리 기반 규칙 = 새 관계/노드 생성

### 예시 비교

| 위치 | 항목 | 동작 |
|------|------|------|
| 공리 탭 | AX003 (역관계 검증) | HAS_SENSOR↔IS_ATTACHED_TO 함께 있는지 **검증** |
| 추론 엔진 | axiom_inverse_sensor | HAS_SENSOR 있으면 IS_ATTACHED_TO **생성** |

---

## 실행 흐름 예시

센서 데이터가 들어왔을 때:

```
1. [제약조건] 데이터 품질 검증
   └→ 온도값이 -50°C ~ 200°C 범위인가? ✓

2. [공리] 논리적 일관성 검증
   └→ HAS_SENSOR 관계가 있으면 IS_ATTACHED_TO도 있는가? ✓

3. [추론 엔진] 새로운 지식 생성
   └→ 이 측정값이 이상 범위인가? → Anomaly 노드 생성
```

**세 시스템은 상호 보완적으로 동작합니다:**
- **제약조건**: 데이터 품질 보장
- **공리**: 논리적 일관성 보장
- **추론 엔진**: 지능적 추론으로 새로운 인사이트 생성

---

## 파일 위치 요약

| 시스템 | 파일 경로 |
|--------|----------|
| 추론 엔진 | `backend/app/services/reasoning_service.py` |
| 공리 | `backend/app/services/axiom_service.py` |
| 제약조건 | `backend/app/services/constraint_service.py` |
| 프론트엔드 | `frontend/src/pages/OntologyExplorer.tsx` |
